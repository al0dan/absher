<!DOCTYPE html>
<html lang="ar" class="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© - Ø£Ø¨Ø´Ø± Ø£Ø¹Ù…Ø§Ù„</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 900px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Card Styles */
        .dash-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            margin-bottom: 25px;
        }

        .dash-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .dash-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--business-theme-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Action Center */
        .action-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff8e1;
            border-right: 4px solid #ffbd2e;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            transition: transform 0.2s;
        }

        .action-item:hover {
            transform: translateX(-5px);
        }

        /* Quick Actions Grid */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        @media (max-width: 600px) {
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .action-btn {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
            display: block;
        }

        .action-btn:hover {
            border-color: var(--business-theme-color);
            background: #f9fcff;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 10px;
            display: block;
        }

        /* Analytics */
        .analytics-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-container {
            position: relative;
            height: 200px;
            width: 100%;
        }

        /* Table */
        .absher-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .absher-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: right;
            color: #555;
        }

        .absher-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
        }

        .bg-green {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .bg-orange {
            background: #fff3e0;
            color: #ef6c00;
        }
    </style>
</head>

<body>
    <!-- Standard Header -->
    <header class="top-header">
        <div class="top-header-inner">
            <div class="header-left">
                <img src="/img/Absher_Business_logo.svg" alt="Absher" class="logo-absher" style="height: 80px;">
            </div>
            <div class="header-right">
                <div class="header-center">
                    <a id="switchLang" href="javascript:void(0);" class="lang-switch">
                        <span class="ar-text">English</span>
                        <span class="en-text">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                        <img src="/img/globe.svg" class="globe">
                    </a>
                </div>
                <!-- Logout -->
                <a href="/logout"
                    style="color: #666; text-decoration: none; margin-left: 15px; font-weight: 500; display: flex; align-items: center; gap: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                </a>
                <img src="/img/vission-logo.png" style="height:55px; margin-left:10px;">
                <img src="/img/moi-logo.svg" style="height:55px">
            </div>
        </div>
    </header>

    <main class="absher-form-section" style="max-width: 1200px; margin: 30px auto; padding: 0 20px;">

        <!-- Welcome & Breadcrumb -->
        <div style="display: flex; justify-content: space-between; align-items: end; margin-bottom: 30px;">
            <div>
                <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© > Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</div>
                <h1 style="margin: 0; font-size: 26px; color: var(--business-theme-color);">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ {{ user.name }}
                </h1>
                <p style="margin: 5px 0 0 0; color: #777;">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ­Ø¯: <span
                        style="font-family: monospace; font-weight: bold;">{{ user.id }}</span></p>
            </div>
            <div style="text-align: left;">
                <div style="font-size: 12px; color: #666;">Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</div>
                <div style="color: #2e7d32; font-weight: bold; display: flex; align-items: center; gap: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                    </svg>
                    Ù†Ø´Ø· Ùˆ Ù…ÙˆØ«Ù‘Ù‚ (Wathq)
                </div>
            </div>
        </div>

        <div class="dashboard-grid">

            <!-- RIGHT COLUMN (Main) -->
            <div>
                <!-- Action Center -->
                {% if actions_required %}
                <div class="dash-card" style="border: 1px solid #ffecb3;">
                    <div class="dash-header" style="border-bottom-color: #ffecb3;">
                        <div class="dash-title" style="color: #ff6f00;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø© ({{ actions_required|length }})
                        </div>
                    </div>
                    {% for action in actions_required %}
                    <div class="action-item">
                        <div>
                            <div style="font-weight: bold;">Ø·Ù„Ø¨ ØªÙˆÙ‚ÙŠØ¹ Ø¹Ù‚Ø¯ #{{ action.id }}</div>
                            <div style="font-size: 12px; color: #666;">Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±: {{ action.buyer if
                                action.supplier_cr == user.cr else action.supplier }}</div>
                        </div>
                        <a href="/contract/{{ action.id }}" class="btn-absher"
                            style="padding: 5px 15px; font-size: 12px;">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¢Ù†</a>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- Financial Overview -->
                <div class="dash-card">
                    <div class="analytics-row">
                        <div style="flex: 1; border-left: 1px solid #eee; padding-left: 20px;">
                            <div style="font-size: 13px; color: #666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù‚ÙˆØ¯</div>
                            <div style="font-size: 32px; font-weight: bold; color: var(--business-theme-color);">{{
                                "{:,.2f}".format(total_value) }} <span style="font-size: 14px;">Ø±.Ø³</span></div>
                            <div style="font-size: 11px; color: #2e7d32;">+12% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚</div>
                        </div>
                        <div style="flex: 1; border-left: 1px solid #eee; padding-left: 20px;">
                            <div style="font-size: 13px; color: #666;">Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù†Ø´Ø·Ø©</div>
                            <div style="font-size: 32px; font-weight: bold;">{{ status_stats.signed }}</div>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 13px; color: #666;">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
                            <div style="font-size: 32px; font-weight: bold;">98%</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Contracts -->
                <div class="dash-card">
                    <div class="dash-header">
                        <div class="dash-title">Ø£Ø­Ø¯Ø« Ø§Ù„Ø¹Ù‚ÙˆØ¯</div>
                        <a href="#" style="font-size: 12px; color: var(--business-theme-color);">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
                    </div>
                    <table class="absher-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù†ÙŠ</th>
                                <th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in contracts[:5] %}
                            <tr>
                                <td style="font-weight: bold;">{{ c.id }}</td>
                                <td>{{ c.buyer }}</td>
                                <td>{{ c.price }}</td>
                                <td>
                                    {% if c.contract_type == 'supply' %}ğŸ“¦ ØªÙˆØ±ÙŠØ¯
                                    {% elif c.contract_type == 'service' %}ğŸ› ï¸ Ø®Ø¯Ù…Ø§Øª
                                    {% elif c.contract_type == 'nda' %}ğŸ”’ NDA
                                    {% else %}ğŸ“„ {{ c.contract_type }}{% endif %}
                                </td>
                                <td>
                                    {% if c.signed_by_supplier and c.signed_by_buyer %}
                                    <span class="status-badge bg-green">Ù…ÙƒØªÙ…Ù„</span>
                                    {% else %}
                                    <span class="status-badge bg-orange">Ø§Ù†ØªØ¸Ø§Ø±</span>
                                    {% endif %}
                                </td>
                                <td><a href="/contract/{{ c.id }}"
                                        style="color: var(--business-theme-color); font-size: 12px; font-weight: bold;">Ø¹Ø±Ø¶</a>
                                </td>
                            </tr>
                            {% endfor %}
                            {% if not contracts %}
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 30px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- LEFT COLUMN (Sidebar/Tools) -->
            <div>
                <!-- Create New -->
                <div class="dash-card"
                    style="background: linear-gradient(135deg, var(--business-theme-color) 0%, #155e96 100%); color: white; border: none;">
                    <h3 style="margin-top: 0;">Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯ Ø¬Ø¯ÙŠØ¯</h3>
                    <p style="font-size: 13px; opacity: 0.9;">Ø§Ø¨Ø¯Ø£ Ø¨ØªÙˆØ«ÙŠÙ‚ ØªØ¹Ø§Ù…Ù„Ø§ØªÙƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø§Ù„Ø¢Ù† Ø¨Ø´ÙƒÙ„ Ù…Ø¹ØªÙ…Ø¯.</p>
                    <a href="/create" class="btn-absher"
                        style="background: white; color: var(--business-theme-color); width: 100%; display: block; text-align: center;">+
                        Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù‚Ø¯</a>
                </div>

                <!-- Visuals -->
                <div class="dash-card">
                    <div class="dash-title" style="font-size: 14px; margin-bottom: 15px;">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯</div>
                    <div class="chart-container" style="height: 180px;">
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>

                <div class="dash-card">
                    <div class="dash-title" style="font-size: 14px; margin-bottom: 15px;">Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</div>
                    <div class="chart-container" style="height: 180px;">
                        <canvas id="statusChart"></canvas>
                    </div>
                </div>
            </div>

        </div>

        <!-- Quick Access Bottom -->
        <h3 style="color: #555; margin-bottom: 15px;">ÙˆØµÙˆÙ„ Ø³Ø±ÙŠØ¹</h3>
        <div class="quick-actions">
            <a href="/create?type=supply" class="action-btn">
                <span class="action-icon">ğŸ“¦</span>
                <div>Ø¹Ù‚Ø¯ ØªÙˆØ±ÙŠØ¯</div>
            </a>
            <a href="/create?type=service" class="action-btn">
                <span class="action-icon">ğŸ› ï¸</span>
                <div>Ø¹Ù‚Ø¯ Ø®Ø¯Ù…Ø§Øª</div>
            </a>
            <a href="/create?type=nda" class="action-btn">
                <span class="action-icon">ğŸ”’</span>
                <div>Ø¹Ø¯Ù… Ø¥ÙØµØ§Ø­</div>
            </a>
            <a href="/create?type=rental" class="action-btn">
                <span class="action-icon">ğŸ </span>
                <div>Ø¹Ù‚Ø¯ Ø¥ÙŠØ¬Ø§Ø±</div>
            </a>
        </div>

    </main>

    <script>
        // Charts Data
        const typeData = {{ type_stats| tojson }};
        const statusData = {{ status_stats| tojson }};

        // Type Chart
        new Chart(document.getElementById('typeChart'), {
            type: 'doughnut',
            data: {
                labels: ['ØªÙˆØ±ÙŠØ¯', 'Ø®Ø¯Ù…Ø§Øª', 'NDA', 'Ø¥ÙŠØ¬Ø§Ø±'],
                datasets: [{
                    data: [typeData.supply, typeData.service, typeData.nda, typeData.rental],
                    backgroundColor: ['#00838f', '#00bfa5', '#ffa000', '#5d4037'],
                    borderWidth: 0
                }]
            },
            options: { plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: { size: 10 } } } } }
        });

        // Status Chart
        new Chart(document.getElementById('statusChart'), {
            type: 'pie',
            data: {
                labels: ['Ù…ÙƒØªÙ…Ù„', 'Ù…Ø¹Ù„Ù‚'],
                datasets: [{
                    data: [statusData.signed, statusData.pending],
                    backgroundColor: ['#2e7d32', '#ef6c00']
                }]
            },
            options: { plugins: { legend: { position: 'bottom' } } }
        });

        // Lang Switch logic
        const switchLang = document.getElementById('switchLang');
        if (switchLang) {
            switchLang.addEventListener('click', () => {
                const html = document.documentElement;
                if (html.lang === 'ar') {
                    html.lang = 'en'; html.classList.remove('rtl'); html.classList.add('ltr');
                } else {
                    html.lang = 'ar'; html.classList.remove('ltr'); html.classList.add('rtl');
                }
            });
        }
    </script>
</body>

</html>